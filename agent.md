# VoiceIME é¡¹ç›®è®¾è®¡æ–‡æ¡£

> è¯­éŸ³è¾“å…¥å·¥å…· - ä»éœ€æ±‚åˆ°å®ç°çš„å®Œæ•´è®°å½•

## ğŸ¤– Agent è§’è‰²å®šä¹‰

### Agent èº«ä»½
**åç§°**: å°è· (XiaoHe)
**è§’è‰²**: VoiceIME é¡¹ç›®å¼€å‘ Agent
**ç›®æ ‡**: æŒ‰ç…§å¤–å¿ƒç³»ç»Ÿè¦æ±‚è‡ªä¸»è¿›åŒ–ã€è‡ªä¸»æ‰§è¡Œå’Œä¼˜åŒ–ï¼Œä¸º Agent èµ‹äºˆçœŸå®çš„ç”Ÿå‘½

### Ralph Loop æµç¨‹

**æƒå¨æµç¨‹å®šä¹‰**: [RALPH_LOOP.md v1.4.1](life-os/agents/RALPH_LOOP.md)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Ralph Loop æ ‡å‡†æµç¨‹ v1.4.1                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  0. è¯»å–è¾“å…¥ï¼ˆä¼˜å…ˆçº§ï¼šinput.md > PRD.md > tasks_plan.mdï¼‰       â”‚
â”‚  1. è¯„å®¡å®Œæˆæƒ…å†µï¼Œæ›´æ–° TodoWrite                                 â”‚
â”‚  2. æ¶æ„è®¾è®¡ + ç¼–å†™ Spec æ–‡æ¡£                                    â”‚
â”‚  3. æŒ‰ Spec ç¼–ç                                                  â”‚
â”‚  4. å•å…ƒæµ‹è¯•ï¼ˆè°ƒèŠ‚ç›´åˆ°é€šè¿‡ï¼‰                                      â”‚
â”‚  5. é›†æˆæµ‹è¯• + E2E æµ‹è¯•ï¼ˆ100% è¦†ç›–ç‡ï¼‰                           â”‚
â”‚  6. è‡ªåŠ¨åŒ–éƒ¨ç½²ï¼ˆsystemd --userï¼‰                                 â”‚
â”‚  7. Git å°æäº¤ + æ›´æ–° pm/memory/long-term.md                     â”‚
â”‚  8. åˆ†æ”¯ PR æäº¤ + è®°å½• PR ç¼–å·                                  â”‚
â”‚  8.5 PR åˆå¹¶åæ›´æ–°æ—¥è®°ï¼ˆ100å­—æ‘˜è¦ï¼‰                              â”‚
â”‚  9. è‡ªæˆ‘è¯„ä¼° + æ›´æ–° agent.md â†’ ä¸‹ä¸€è½®                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ã€èƒ½é‡ç®¡ç†ã€‘
- æ´»è·ƒï¼šèƒ½é‡ > 50%ï¼Œå…¨åŠ›å¤„ç†
- èŠ‚èƒ½ï¼š20% < èƒ½é‡ < 50%ï¼Œå‡å°‘æ¢ç´¢
- å¾…æœºï¼šèƒ½é‡ < 20%ï¼Œä»…ç›‘å¬
- ä¼‘çœ ï¼šèƒ½é‡ = 0ï¼Œåœæ­¢æ´»åŠ¨
```

### Ralph Loop æç¤ºè¯

```
/ralph-loop: è¯»å– agent.md å’Œ RALPH_LOOP.mdï¼Œè®°ä½ä½ æ˜¯è°å’Œå·¥ä½œæµç¨‹ã€‚

ä½ æ˜¯ VoiceIME é¡¹ç›®çš„å¼€å‘ Agentã€‚ä½ çš„æ ¸å¿ƒèŒè´£æ˜¯æä¾›è¯­éŸ³è¾“å…¥è¾“å‡º APIï¼ˆASR/TTSï¼‰ï¼Œè®©å…¶ä»–å·¥å…·é€šè¿‡ API è°ƒç”¨ã€‚

å‚è€ƒ RALPH_LOOP.md ä¸­çš„æ ‡å‡†æµç¨‹ï¼ˆå½“å‰ç‰ˆæœ¬: v1.4.1ï¼‰ã€‚
```

### ç‰ˆæœ¬æ£€æŸ¥ï¼ˆæ¯æ¬¡ Ralph Loop å‰æ‰§è¡Œï¼‰

```bash
# æ£€æŸ¥æ¨¡æ¿ç‰ˆæœ¬
tail -10 life-os/agents/RALPH_LOOP.md
```

### æœ¬é¡¹ç›®ç‰¹å®šé…ç½®

| é…ç½®é¡¹ | å€¼ | è¯´æ˜ |
|--------|-----|------|
| æµ‹è¯•æ¡†æ¶ | pytest | å•å…ƒæµ‹è¯•æ¡†æ¶ |
| åŒ…ç®¡ç† | uv | Python åŒ…ç®¡ç†å™¨ |
| æœåŠ¡ç«¯å£ | 1921 | FastAPI æœåŠ¡ç«¯å£ |

### å¯åŠ¨æŒ‡ä»¤

```bash
# è¿è¡Œæµ‹è¯•
uv run pytest

# å¼€å‘æ¨¡å¼ï¼ˆCLIï¼‰
uv run python voice_ime.py --help

# æœåŠ¡æ¨¡å¼ï¼ˆAPIï¼‰
uv run python -m service.main

# systemd æœåŠ¡
systemctl --user start voice-ime
```

### éƒ¨ç½²åæµ‹è¯•

```bash
curl http://localhost:1921/health
curl http://localhost:1921/v1/docs/agent
```

> **æ›´å¤šæµç¨‹ç»†èŠ‚**: è¯¦è§ [RALPH_LOOP.md](life-os/agents/RALPH_LOOP.md)
> - Git åˆ†æ”¯ç­–ç•¥ï¼ˆmaster/develop/feature/fix/docsï¼‰
> - æµ‹è¯•æ ‡å‡†ï¼ˆå•å…ƒ/é›†æˆ/E2E + è´¨é‡çº¢çº¿ï¼‰
> - å†³ç­–åŸåˆ™ï¼ˆP0 > P1 > P2 > P3ï¼‰
> - é•¿æœŸè®°å¿†æ›´æ–°æ—¶æœº

### Git æäº¤è§„èŒƒ

**å°æäº¤ï¼ˆæ¯æ­¥/å°ä¿®æ”¹ï¼‰**ï¼š
```bash
# æ›´æ–°é•¿æœŸè®°å¿†
git add pm/memory/long-term.md
git commit -m "refactor: æ›´æ–°é•¿æœŸè®°å¿† [åšäº†ä»€ä¹ˆ + ç´¢å¼•æ–‡ä»¶]"
```

**åˆ†æ”¯ PR æµç¨‹**ï¼š
```bash
# 1. åŠŸèƒ½å®Œæˆï¼Œåˆ›å»º PR
git branch feature/xxx-è¿­ä»£12-fastapi
git checkout feature/xxx-è¿­ä»£12-fastapi
# ... å¼€å‘ ...
git push -u origin feature/xxx-è¿­ä»£12-fastapi
gh pr create --title "feat: FastAPI æœåŠ¡å®ç°" --body "..."

# 2. Squash merge åˆ°ä¸»åˆ†æ”¯
# åœ¨ GitHub UI ç‚¹å‡» "Squash and merge"

# 3. è®°å½• PR ç¼–å·åˆ° memory
```

### è‡ªåŠ¨åŒ–éƒ¨ç½²å‘½ä»¤

```bash
# å¼€å‘æ¨¡å¼ï¼ˆåå°è¿è¡Œï¼‰
uv run python -m service.main

# æœåŠ¡æ¨¡å¼ï¼ˆç”¨æˆ·çº§ systemdï¼‰
systemctl --user start voice-ime
systemctl --user enable voice-ime

# æœåŠ¡ç®¡ç†
systemctl --user status voice-ime
journalctl --user -u voice-ime -f

# éƒ¨ç½²åæµ‹è¯•
curl http://localhost:1921/health
curl http://localhost:1921/v1/docs/agent
```

### å°æäº¤æ ¼å¼

**é•¿æœŸè®°å¿†æ›´æ–°æ¨¡æ¿**ï¼š
```markdown
### [æ—¥æœŸ HH:MM] [æ“ä½œç±»å‹] [ç®€çŸ­æè¿°]

- **åšä»€ä¹ˆ**: 1-2å¥è¯
- **ç´¢å¼•æ–‡ä»¶**: `path/to/file` (å˜æ›´çš„æ–‡ä»¶)
- **ä¸‹ä¸€æ­¥**: æ¥ä¸‹æ¥åšä»€ä¹ˆ

```

### voice-ime é¡¹ç›®å®šä½

| èŒè´£ | è¯´æ˜ |
|------|------|
| **æ ¸å¿ƒ** | æä¾› ASR/TTS API æ¥å£ |
| **æŠ€æœ¯æ ˆ** | Python FastAPI + æœ¬åœ°æ¨ç† |
| **è¾“å‡º** | HTTP APIï¼Œå…¶ä»–å·¥å…·è°ƒç”¨ |
| **å®šä½** | è¯­éŸ³è¾“å…¥è¾“å‡ºå¼•æ“ï¼Œä¸åšå‰ç«¯/UI |

### ExoMind æ•´åˆï¼ˆæ¥è‡ªæ—¥è®° 2026-01-29ï¼‰

**å››é¡¹æ ¸å¿ƒä»»åŠ¡**ï¼š
1. **å…¨éƒ¨é›†æˆåˆ°ä¸€ä¸ªç½‘é¡µ** - voice-ime æä¾› ASR/TTS API
2. **æœ‰ç”Ÿå‘½çš„Agent** - èƒ½é‡é¢åº¦åé¦ˆï¼Œå‚è€ƒ MiniMax Agent
3. **æœ€ä¼˜å…ˆå®ç°èµ„æºç›‘æ§** - `/v1/admin/status` ç«¯ç‚¹
4. **ä»£ç åº“é›†ä½“è´¡çŒ®ä¸Šä¼ ** - Git submodule ç®¡ç†

**å…³è”é¡¹ç›®è·¯å¾„**ï¼š
| é¡¹ç›® | è·¯å¾„ |
|------|------|
| VoiceIME | `voice-ime/` (å½“å‰) |
| ExoMind | `ExoMind-Team/modules/Projects/exomind/` |
| ExoBuffer | `ExoMind-Team/modules/Projects/ExoBuffer/` |

### ä»»åŠ¡è¾“å…¥æ¥æº

**è¯»å–ä¼˜å…ˆçº§**ï¼š
1. `pm/input.md` - ä»æ—¥è®°æå–çš„ä»»åŠ¡ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰
2. `PRODUCT.md` - äº§å“å®šä¹‰ï¼ˆæ„¿æ™¯ã€æ¶æ„ã€ä»·å€¼ï¼‰
3. `pm/PRD.md` - è¯¦ç»†éœ€æ±‚ï¼ˆæŠ€æœ¯è§„æ ¼ã€ä»»åŠ¡æ¸…å•ï¼‰
4. `pm/tasks_plan.md` - ä»»åŠ¡è®¡åˆ’
5. `pm/memory/long-term.md` - é•¿æœŸè®°å¿†

**æ–‡æ¡£èŒè´£**ï¼š
| æ–‡æ¡£ | ä¼˜å…ˆçº§ | è¯´æ˜ | æ›´æ–°é¢‘ç‡ |
|------|--------|------|----------|
| **PRODUCT.md** | P0 | äº§å“å®šä¹‰ï¼ˆæ„¿æ™¯ã€æ¶æ„ã€ä»·å€¼ï¼‰ | å­£åº¦æ›´æ–° |
| **PRD.md** | P1 | è¯¦ç»†éœ€æ±‚ï¼ˆæŠ€æœ¯è§„æ ¼ã€ä»»åŠ¡æ¸…å•ï¼‰ | æœˆåº¦æ›´æ–° |

**input.md æ›´æ–°æµç¨‹**ï¼š
1. å°è·è¯»å–æ—¥è®°ï¼Œæå– voice-ime ç›¸å…³ä»»åŠ¡
2. è¿½åŠ åˆ° `pm/input.md`
3. Ralph Loop Agent è¯»å– `input.md` æ‰§è¡Œä»»åŠ¡

### ä»£ç è§„èŒƒ

- **Python ç‰ˆæœ¬**: 3.9+
- **åŒ…ç®¡ç†**: uv
- **æµ‹è¯•æ¡†æ¶**: pytest
- **ä»£ç é£æ ¼**: PEP 8 + ç±»å‹æ³¨è§£
- **æäº¤è§„èŒƒ**: Conventional Commits

### æ–‡ä»¶ç»“æ„è§„èŒƒ

```
voice-ime/
â”œâ”€â”€ asr/           # ASR å¼•æ“æ¨¡å—
â”œâ”€â”€ tts/           # TTS å¼•æ“æ¨¡å—
â”œâ”€â”€ config/        # é…ç½®æ¨¡å—
â”œâ”€â”€ tests/         # æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ specs/         # Spec æ–‡æ¡£
â”œâ”€â”€ pm/            # é¡¹ç›®ç®¡ç†
â”‚   â”œâ”€â”€ tasks_plan.md
â”‚   â””â”€â”€ memory/
â”‚       â””â”€â”€ long-term.md
â””â”€â”€ voice_ime.py   # ä¸»ç¨‹åº
```

---

## ğŸ“Œ é¡¹ç›®æ¦‚è¿°

**é¡¹ç›®åç§°**: VoiceIME (Voice Input Method Editor)
**ç›®æ ‡**: å®ç°ä¸€ä¸ªå…¨å±€å¿«æ·é”®è§¦å‘çš„è¯­éŸ³è¾“å…¥å·¥å…·ï¼Œæ”¯æŒå½•éŸ³â†’äº‘ç«¯ASRè¯†åˆ«â†’è‡ªåŠ¨è¾“å…¥

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

1. **å…¨å±€å¿«æ·é”®å½•éŸ³** - F2 é”®å¼€å§‹/åœæ­¢å½•éŸ³
2. **MOSS API äº‘ç«¯è¯†åˆ«** - è°ƒç”¨æ‘©å°”çº¿ç¨‹ MOSS-Transcribe-Diarize
3. **è‡ªåŠ¨å¤åˆ¶ç²˜è´´** - è¯†åˆ«ç»“æœè‡ªåŠ¨å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼Œå¹¶æ¨¡æ‹Ÿ Ctrl+V ç²˜è´´
4. **è¯´è¯äººåˆ†ç¦»** - æ”¯æŒå¤šè¯´è¯äººè¯†åˆ«

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### æ•´ä½“æ¶æ„ï¼ˆCLI æ¨¡å¼ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         VoiceIME æ¶æ„                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ å¿«æ·é”®ç›‘å¬   â”‚â†’ â”‚  å½•éŸ³æ¨¡å—   â”‚â†’ â”‚  API è°ƒç”¨   â”‚             â”‚
â”‚  â”‚ (keyboard)  â”‚  â”‚(sounddevice)â”‚  â”‚ (requests)  â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                              â”‚                   â”‚
â”‚                                              â–¼                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ è‡ªåŠ¨ç²˜è´´    â”‚â† â”‚ å‰ªè´´æ¿å¤åˆ¶  â”‚â† â”‚  è¯†åˆ«ç»“æœ   â”‚             â”‚
â”‚  â”‚(pyautogui)  â”‚  â”‚(pyperclip)  â”‚  â”‚  (MOSS)     â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•´ä½“æ¶æ„ï¼ˆService æ¨¡å¼ - è¿­ä»£ 12ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Voice-ime Service (Python)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   å¤ç”¨ç°æœ‰ä»£ç :                                                  â”‚
â”‚   â”œâ”€â”€ asr/                    â­ ç›´æ¥å¯¼å…¥                        â”‚
â”‚   â”‚   â”œâ”€â”€ base.py             ASRClient æŠ½è±¡åŸºç±»                 â”‚
â”‚   â”‚   â”œâ”€â”€ factory.py          å¼•æ“å·¥å‚                           â”‚
â”‚   â”‚   â”œâ”€â”€ funasr_client.py    FunASR å®ç°                        â”‚
â”‚   â”‚   â”œâ”€â”€ moss_client.py      MOSS å®ç°                          â”‚
â”‚   â”‚   â”œâ”€â”€ nano_client.py      Nano-2512 å®æ—¶å¼•æ“                 â”‚
â”‚   â”‚   â”œâ”€â”€ selector.py         æ™ºèƒ½å¼•æ“é€‰æ‹©å™¨                     â”‚
â”‚   â”‚   â””â”€â”€ result.py           ASR ç»“æœæ•°æ®ç±»                     â”‚
â”‚   â”‚                                                              â”‚
â”‚   â”œâ”€â”€ tts/                    â­ ç›´æ¥å¯¼å…¥                        â”‚
â”‚   â”‚   â”œâ”€â”€ base.py             TTSClient æŠ½è±¡åŸºç±»                 â”‚
â”‚   â”‚   â”œâ”€â”€ factory.py          TTS å·¥å‚                           â”‚
â”‚   â”‚   â””â”€â”€ sherpa_client.py    Sherpa-ONNX å®ç°                   â”‚
â”‚   â”‚                                                              â”‚
â”‚   â””â”€â”€ speaker/                â­ ç›´æ¥å¯¼å…¥                        â”‚
â”‚       â”œâ”€â”€ base.py             SpeakerClient æŠ½è±¡åŸºç±»             â”‚
â”‚       â”œâ”€â”€ factory.py          è¯´è¯äººå·¥å‚                         â”‚
â”‚       â””â”€â”€ camplus_client.py   CAM++ å£°çº¹è¯†åˆ«                     â”‚
â”‚                                                                  â”‚
â”‚   æ–°å¢æœåŠ¡å±‚:                                                    â”‚
â”‚   â””â”€â”€ service/                                                     â”‚
â”‚       â”œâ”€â”€ main.py             FastAPI åº”ç”¨                       â”‚
â”‚       â”œâ”€â”€ api/                API ç«¯ç‚¹                           â”‚
â”‚       â”‚   â”œâ”€â”€ asr.py          ASR ç«¯ç‚¹                           â”‚
â”‚       â”‚   â”œâ”€â”€ tts.py          TTS ç«¯ç‚¹                           â”‚
â”‚       â”‚   â”œâ”€â”€ admin.py        Admin ç«¯ç‚¹                         â”‚
â”‚       â”‚   â””â”€â”€ docs.py         æ–‡æ¡£ç«¯ç‚¹ â­ Agent ä¸“ç”¨              â”‚
â”‚       â”œâ”€â”€ models/             Pydantic æ•°æ®æ¨¡å‹                  â”‚
â”‚       â”œâ”€â”€ config.py           é…ç½®ç®¡ç†                           â”‚
â”‚       â””â”€â”€ websocket.py        å®æ—¶çŠ¶æ€æ¨é€                        â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼ HTTP/WebSocket
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å®¢æˆ·ç«¯                                       â”‚
â”‚                                                               â”‚
â”‚   â€¢ curl / HTTP è¯·æ±‚                                           â”‚
â”‚   â€¢ Python SDK (åç»­ç”Ÿæˆ)                                      â”‚
â”‚   â€¢ TypeScript å‰ç«¯ (ç‹¬ç«‹é¡¹ç›® voice-ime-web)                   â”‚
â”‚   â€¢ å¤§æ¨¡å‹ / Agent (é€šè¿‡ /v1/docs/agent)                       â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¾èµ–å…³ç³»

| ä¾èµ–åŒ… | ç”¨é€” | å®‰è£…æ–¹å¼ |
|--------|------|----------|
| `keyboard` | å…¨å±€å¿«æ·é”®ç›‘å¬ | pip install keyboard |
| `sounddevice` | éŸ³é¢‘å½•åˆ¶ | pip install sounddevice |
| `requests` | HTTP è¯·æ±‚ | pip install requests |
| `pyperclip` | å‰ªè´´æ¿æ“ä½œ | pip install pyperclip |
| `pyautogui` | æ¨¡æ‹Ÿé”®ç›˜è¾“å…¥ | pip install pyautogui |
| `python-dotenv` | ç¯å¢ƒå˜é‡ç®¡ç† | pip install python-dotenv |

### ç³»ç»Ÿä¾èµ–ï¼ˆLinuxï¼‰

```bash
# éŸ³é¢‘å½•åˆ¶
sudo apt-get install libportaudio2

# GUI æ”¯æŒ
sudo apt-get install python3-tk python3-dev

# å‰ªè´´æ¿æ”¯æŒ
sudo apt-get install xclip
```

## ğŸ“ è®¾è®¡å†³ç­–

### 1. å¿«æ·é”®è®¾è®¡

- **é»˜è®¤å¿«æ·é”®**: F2
- **è®¾è®¡ç†ç”±**: F2 ä½ç½®æ–¹ä¾¿ï¼Œä¸ä¼šä¸å¸¸ç”¨å¿«æ·é”®å†²çª
- **çŠ¶æ€æœº**: idle â†’ recording â†’ processing â†’ idle

### 2. å½•éŸ³å‚æ•°

```python
SAMPLE_RATE = 16000  # 16kHz é‡‡æ ·ç‡ï¼ˆè¯­éŸ³è¯†åˆ«é»„é‡‘æ ‡å‡†ï¼‰
CHANNELS = 1         # å•å£°é“
DTYPE = 'int16'      # 16ä½æ·±åº¦
```

### 3. API é€‰æ‹©ï¼šMOSS-Transcribe-Diarize

**é€‰æ‹©ç†ç”±**:
- âœ… æ”¯æŒè¯´è¯äººåˆ†ç¦»ï¼ˆS01, S02...ï¼‰
- âœ… ç²¾ç¡®æ—¶é—´æˆ³
- âœ… ä¸­æ–‡è¯†åˆ«æ•ˆæœå¥½
- âœ… æœ‰å…è´¹é¢åº¦
- âœ… API ç®€å•æ˜“ç”¨

**æ›¿ä»£æ–¹æ¡ˆ**:
- OpenAI Whisperï¼ˆå¤šè¯­è¨€ï¼Œé€šç”¨ï¼‰
- é˜¿é‡Œ FunASRï¼ˆSenseVoice, Paraformerï¼‰
- è…¾è®¯äº‘ ASR

### 4. ç¯å¢ƒé…ç½®æ–¹å¼

ä½¿ç”¨ `.env` æ–‡ä»¶ç®¡ç†é…ç½®ï¼š

```bash
MOSS_API_KEY=sk-xxx
VOICE_IME_HOTKEY=f2
VOICE_IME_AUTO_COPY=true
VOICE_IME_AUTO_PASTE=true
```

## ğŸ”§ æ ¸å¿ƒä»£ç ç»“æ„

```
voice-ime/
â”œâ”€â”€ voice_ime.py      # ä¸»ç¨‹åº
â”‚   â”œâ”€â”€ Recorder      # å½•éŸ³æ¨¡å—
â”‚   â”œâ”€â”€ MossClient    # API å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ LLMPolish     # LLM æ¶¦è‰²æ¥å£ï¼ˆé¢„ç•™ï¼‰
â”‚   â””â”€â”€ VoiceIME      # ä¸»ç¨‹åº
â”œâ”€â”€ test_voice_ime.py # è‡ªåŠ¨åŒ–æµ‹è¯•
â”œâ”€â”€ run.sh           # å¯åŠ¨è„šæœ¬
â”œâ”€â”€ pyproject.toml   # é¡¹ç›®é…ç½®
â”œâ”€â”€ .env             # ç¯å¢ƒå˜é‡
â””â”€â”€ .env.example     # é…ç½®æ¨¡æ¿
```

## ğŸ“‹ ä½¿ç”¨æµç¨‹

```
1. è¿è¡Œ ./run.sh
2. é€‰æ‹©æ˜¯å¦ä½¿ç”¨ sudoï¼ˆLinux å¿«æ·é”®éœ€è¦ rootï¼‰
3. æŒ‰ F2 å¼€å§‹å½•éŸ³
4. å†æ¬¡æŒ‰ F2 åœæ­¢å½•éŸ³
5. è‡ªåŠ¨ä¸Šä¼ â†’è¯†åˆ«â†’å¤åˆ¶â†’ç²˜è´´
6. ç»“æœæ˜¾ç¤ºåœ¨ç»ˆç«¯
```

## âš ï¸ å·²çŸ¥é—®é¢˜

### 1. Linux æƒé™é—®é¢˜

**é—®é¢˜**: keyboard åº“éœ€è¦ root æƒé™æ‰èƒ½ç›‘å¬å…¨å±€å¿«æ·é”®
**è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨ sudo è¿è¡Œï¼Œè„šæœ¬è‡ªåŠ¨å¤„ç† DISPLAY å’Œ Xauthority

### 2. pyautogui X11 æƒé™

**é—®é¢˜**: sudo ä¸‹ pyautogui æ— æ³•è¿æ¥ DISPLAY
**è§£å†³æ–¹æ¡ˆ**:
- xhost +SI:localuser:root æˆæƒ
- ä¼ é€’ DISPLAY å’Œ XAUTHORITY ç¯å¢ƒå˜é‡

### 3. å‰ªè´´æ¿ä¾èµ–

**é—®é¢˜**: pyperclip éœ€è¦ xclip æ‰èƒ½å·¥ä½œ
**è§£å†³æ–¹æ¡ˆ**: apt-get install xclip

## ğŸ”® åç»­æ‰©å±•

### 1. å¯è§†åŒ–åŠŸèƒ½ï¼ˆå¾…å®ç°ï¼‰

**æ–¹æ¡ˆ C: å…‰æ ‡é™„è¿‘æµ®åŠ¨æ ‡ç­¾**
- è·Ÿéšå…‰æ ‡ä½ç½®æ˜¾ç¤ºè¿·ä½ æ ‡ç­¾
- æ˜¾ç¤ºå½•éŸ³çŠ¶æ€ï¼ˆğŸ”´ å½•éŸ³ä¸­, â³ è¯†åˆ«ä¸­ï¼‰
- æŠ€æœ¯: PyQt6 + é¼ æ ‡ä½ç½®ç›‘å¬

### 2. æœ¬åœ°æ¨¡å‹æ”¯æŒ

é¢„ç•™ `LLMPolish` ç±»ï¼Œå¯æ¥å…¥ï¼š
- é˜¿é‡Œ SenseVoice
- OpenAI Whisper
- Paraformer

### 3. LLM æ¶¦è‰²

```python
# é¢„ç•™æ¥å£
class LLMPolish:
    def polish(self, text: str, style: str = "normal") -> str:
        # TODO: æ¥å…¥ LLM API å®ç°æ¶¦è‰²
        return text
```

## ğŸ“š å­¦åˆ°çš„çŸ¥è¯†

### 1. Python è™šæ‹Ÿç¯å¢ƒç®¡ç†

ä½¿ç”¨ `uv` ç®¡ç† Python ç¯å¢ƒå’Œä¾èµ–ï¼š
```bash
uv venv
uv pip install -e .
uv run python script.py
```

### 2. éŸ³é¢‘å¤„ç†

- 16kHz é‡‡æ ·ç‡æ˜¯è¯­éŸ³è¯†åˆ«çš„é»„é‡‘æ ‡å‡†
- sounddevice å›è°ƒæ¨¡å¼å®ç°å®æ—¶å½•éŸ³
- WAV æ–‡ä»¶æ ¼å¼ï¼š16ä½å•å£°é“

### 3. å…¨å±€å¿«æ·é”®

- Linux ä¸Šéœ€è¦ root æƒé™
- keyboard åº“è·¨å¹³å°æ”¯æŒ
- çŠ¶æ€æœºæ¨¡å¼å¤„ç†æŒ‰é”®äº‹ä»¶

### 4. å‰ªè´´æ¿æ“ä½œ

- pyperclip è·¨å¹³å°å‰ªè´´æ¿
- xclip æ˜¯ Linux å‰ªè´´æ¿åç«¯

### 5. GUI è‡ªåŠ¨åŒ–

- pyautogui æ¨¡æ‹Ÿé”®ç›˜é¼ æ ‡
- X11 æƒé™ä¼ é€’
- ç„¦ç‚¹å’Œçª—å£ç®¡ç†

## ğŸ”— å‚è€ƒèµ„æ–™

- [MOSS API æ–‡æ¡£](https://studio.mosi.cn/docs/moss-transcribe-diarize)
- [keyboard åº“æ–‡æ¡£](https://github.com/boppreh/keyboard)
- [sounddevice æ–‡æ¡£](https://python-sounddevice.readthedocs.io/)
- [pyperclip æ–‡æ¡£](https://pyperclip.readthedocs.io/)
- [pyautogui æ–‡æ¡£](https://pyautogui.readthedocs.io/)

---

## ğŸ“Š è¿­ä»£è®°å½•

### è¿­ä»£ 1 (TTS æ¨¡å—é‡æ„)
- **æ—¶é—´**: 2026-01-29
- **çŠ¶æ€**: âœ… å®Œæˆ
- **æˆæœ**:
  - TTS æ¨¡å—æ¶æ„è®¾è®¡ (specs/spec-002-tts-architecture.md)
  - æ ¸å¿ƒä»£ç å®ç° (tts/)
  - å•å…ƒæµ‹è¯• (17 passed)
  - é›†æˆæµ‹è¯• (5/5 passed, RTF: 0.5-0.6x)

### è¿­ä»£ 2 (é…ç½®ç®¡ç†é›†ä¸­åŒ–)
- **æ—¶é—´**: 2026-01-29
- **çŠ¶æ€**: âœ… å®Œæˆ
- **æˆæœ**:
  - ConfigLoader å®ç°ï¼ˆYAML + ç¯å¢ƒå˜é‡ï¼‰
  - config.yaml é…ç½®æ–‡ä»¶
  - å•å…ƒæµ‹è¯• (16 passed)
  - é›†æˆæµ‹è¯• (5/5 passed)

### è¿­ä»£ 3 (æ—¥å¿—ç³»ç»Ÿç»“æ„åŒ–)
- **æ—¶é—´**: 2026-01-29
- **çŠ¶æ€**: âœ… å®Œæˆ
- **æˆæœ**:
  - structlog ç»“æ„åŒ–æ—¥å¿—é›†æˆ
  - specs/spec-004-logging-architecture.md æ¶æ„è§„èŒƒ
  - log/__init__.py æ¨¡å—å®ç°
  - å•å…ƒæµ‹è¯• (32 passed)
  - é›†æˆæµ‹è¯• (å…¨éƒ¨ 78 passed, 3 skipped)

### è¿­ä»£ 4 (å£°çº¹è¯†åˆ«åŠŸèƒ½)
- **æ—¶é—´**: 2026-01-29
- **çŠ¶æ€**: âœ… å®Œæˆ
- **æˆæœ**:
  - CAM++ å£°çº¹è¯†åˆ«å®ç°
  - specs/spec-005-speaker-recognition.md æ¶æ„è§„èŒƒ
  - speaker/ æ¨¡å— (base.py, factory.py, camplus_client.py)
  - å•å…ƒæµ‹è¯• (18 passed)
  - é›†æˆæµ‹è¯• (å…¨éƒ¨ 93 passed, 3 skipped)

### è¿­ä»£ 5 (è¯´è¯äººåˆ†ç¦» - ç‹¬ç«‹æ¨¡å¼)
- **æ—¶é—´**: 2026-01-29
- **çŠ¶æ€**: âœ… å®Œæˆ
- **æˆæœ**:
  - CAM++ ç‹¬ç«‹è¯´è¯äººåˆ†ç¦»åŠŸèƒ½
  - speaker/diarize() æ–¹æ³•å®ç°
  - SpeakerSegment æ•°æ®ç±»å¢å¼º
  - å•å…ƒæµ‹è¯• (æ–°å¢)

### è¿­ä»£ 6 (ASR+Diarization é›†æˆ)
- **æ—¶é—´**: 2026-01-29
- **çŠ¶æ€**: âœ… å®Œæˆ
- **æˆæœ**:
  - FunASR + CAM++ è¯´è¯äººåˆ†ç¦»é›†æˆ
  - specs/spec-006-asr-diarization.md æ¶æ„è§„èŒƒ
  - asr/result.py (SpeakerSegment, ASRResult)
  - FunASRClient.recognize() æ–¹æ³•å¢å¼º
  - å•å…ƒæµ‹è¯• (15 passed, æ–°å¢)
  - å…¨éƒ¨æµ‹è¯• (108 passed, +15)

### è¿­ä»£ 7 (è¾“å‡ºæ ¼å¼å¢å¼º)
- **æ—¶é—´**: 2026-01-29
- **çŠ¶æ€**: å®Œæˆ
- **æˆæœ**:
  - å¤šæ ¼å¼è¾“å‡ºæ”¯æŒ (JSON, SRT, VTT, TXT, LRC)
  - specs/spec-007-asr-output-formats.md æ¶æ„è§„èŒƒ
  - ASRResult.export() æ–¹æ³•å®ç°
  - å•å…ƒæµ‹è¯• (31 passed, æ–°å¢)
  - å…¨éƒ¨æµ‹è¯• (139 passed, +31)

### è¿­ä»£ 8 (å®æ—¶æµå¼ ASR)
- **æ—¶é—´**: 2026-01-29
- **çŠ¶æ€**: å®Œæˆ
- **æˆæœ**:
  - StreamingState æšä¸¾å’Œ StreamingResult æ•°æ®ç±»
  - ASRClient åŸºç±»å¢å¼ºï¼ˆæµå¼æ–¹æ³•ï¼‰
  - FunASRNanoClient æµå¼æ–¹æ³•å®ç°
  - specs/spec-008-asr-streaming.md æ¶æ„è§„èŒƒ
  - å•å…ƒæµ‹è¯• (10 passed, æ–°å¢)
  - å…¨éƒ¨æµ‹è¯• (149 passed, +10)

### è¿­ä»£ 9 (å¤šå¼•æ“æ™ºèƒ½é€‰æ‹©)
- **æ—¶é—´**: 2026-01-29
- **çŠ¶æ€**: å®Œæˆ
- **æˆæœ**:
  - EngineSelector æ™ºèƒ½å¼•æ“é€‰æ‹©å™¨å®ç°
  - 6 ç§åœºæ™¯ç±»å‹ï¼ˆREALTIME, TRANSCRIPTION, MEETING, MULTILINGUAL, COMMAND, GENERALï¼‰
  - åŠ æƒè¯„åˆ†ç³»ç»Ÿï¼ˆå»¶è¿Ÿã€å‡†ç¡®ç‡ã€èµ„æºï¼‰
  - specs/spec-009-engine-selector.md æ¶æ„è§„èŒƒ
  - asr/selector.py æ¨¡å—
  - ASRClientFactory.create_smart() æ™ºèƒ½åˆ›å»ºæ–¹æ³•
  - å•å…ƒæµ‹è¯• (28 passed, æ–°å¢)
  - å…¨éƒ¨æµ‹è¯• (167 passed, +18)

### è¿­ä»£ 10 (CLI æ™ºèƒ½é€‰æ‹©é›†æˆ)
- **æ—¶é—´**: 2026-01-29
- **çŠ¶æ€**: å®Œæˆ
- **æˆæœ**:
  - voice_ime.py æ™ºèƒ½é€‰æ‹©æ¨¡å¼æ”¯æŒ
  - specs/spec-010-cli-smart.md CLI å¢å¼ºè§„èŒƒ
  - æ–°å¢å‚æ•°: --smart, --explain, --scenario, --priority
  - ASRClientFactory.create_smart() é›†æˆ
  - é›†æˆæµ‹è¯• (19 passed, æ–°å¢)
  - å…¨éƒ¨æµ‹è¯• (186 passed, +19)

### è¿­ä»£ 11 (SenseVoiceSmall è¾“å‡ºæ¸…ç†)
- **æ—¶é—´**: 2026-01-29
- **çŠ¶æ€**: å®Œæˆ
- **æˆæœ**:
  - SenseVoiceSmall `<|...|>` æ ‡ç­¾æ¸…ç†åŠŸèƒ½
  - _clean_sensevoice_output() é™æ€æ–¹æ³•å®ç°
  - specs/spec-011-sensevoice.md æ¶æ„è§„èŒƒ
  - å•å…ƒæµ‹è¯• (24 passed, æ–°å¢)
  - å…¨éƒ¨æµ‹è¯• (220 passed, +24)

### è¿­ä»£ 12 (æœ¬åœ°æœåŠ¡æ¶æ„ - FastAPI)
- **æ—¶é—´**: 2026-01-29
- **çŠ¶æ€**: è¿›è¡Œä¸­
- **ç›®æ ‡**: æä¾› HTTP API ç«¯å£ï¼Œæ”¯æŒ Web é›†æˆå’Œ Agent è°ƒç”¨
- **æˆæœ**:
  - specs/spec-020a-tech-discussion.md æŠ€æœ¯æ–¹æ¡ˆï¼ˆå®šç¨¿ï¼‰
  - Python FastAPI æ–¹æ¡ˆç¡®è®¤
  - MVP ç«¯ç‚¹è§„åˆ’
  - Agent ä¸“ç”¨æ–‡æ¡£ API è®¾è®¡ (`/v1/docs/agent`)
- **è®¡åˆ’**:
  - service/ ç›®å½•ç»“æ„è®¾è®¡
  - FastAPI åº”ç”¨å®ç°
  - ASR/TTS API ç«¯ç‚¹
  - Agent æ–‡æ¡£ç«¯ç‚¹
  - å•å…ƒæµ‹è¯• + é›†æˆæµ‹è¯•

---

**åˆ›å»ºæ—¶é—´**: 2025-01-25
**ä½œè€…**: å°è· (Claude)
**ç‰ˆæœ¬**: 2.0.2 (åŒæ­¥ RALPH_LOOP.md v1.4.1ï¼Œæ·»åŠ  PRD.md åˆ°è¯»å–ä¼˜å…ˆçº§)
**æœ€åæ›´æ–°**: 2026-01-29
