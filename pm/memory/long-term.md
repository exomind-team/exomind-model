# Voice-ime é•¿æœŸè®°å¿†

> ç‰ˆæœ¬ï¼šv1.8
> åˆ›å»ºæ—¶é—´ï¼š2026-01-27
> æ›´æ–°æ—¶é—´ï¼š2026-01-30 18:45
> Agentï¼šexomind-model
> è¯´æ˜ï¼šè®°å½•é¡¹ç›®ç»éªŒã€æŠ€æœ¯å†³ç­–ã€è¸©å‘è®°å½•

---

## ä»»åŠ¡æ¥æºè¯´æ˜

### input.md ä»»åŠ¡è¾“å…¥æµç¨‹ï¼ˆæ¥è‡ªæ—¥è®° 2026-01-29ï¼‰

**æ•°æ®æµ**ï¼š
```
æ—¥è®° (2026-01-29) â†’ input.md â†’ Ralph Loop Agent â†’ æ‰§è¡Œä»»åŠ¡
```

**è¯»å–ä¼˜å…ˆçº§**ï¼š
1. `pm/input.md` - ä»æ—¥è®°æå–çš„ä»»åŠ¡ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰
2. `pm/PRD.md` - äº§å“éœ€æ±‚æ–‡æ¡£
3. `pm/tasks_plan.md` - ä»»åŠ¡è®¡åˆ’
4. `pm/memory/long-term.md` - é•¿æœŸè®°å¿†

**ExoMind å››é¡¹æ ¸å¿ƒä»»åŠ¡**ï¼š
| # | ä»»åŠ¡ | exomind-model å…³è” |
|---|------|----------------|
| 1 | å…¨éƒ¨é›†æˆåˆ°ä¸€ä¸ªç½‘é¡µ | æä¾› ASR/TTS API |
| 2 | æœ‰ç”Ÿå‘½çš„Agent | èƒ½é‡é¢åº¦åé¦ˆ |
| 3 | æœ€ä¼˜å…ˆå®ç°èµ„æºç›‘æ§ | `/v1/admin/status` |
| 4 | ä»£ç åº“é›†ä½“è´¡çŒ®ä¸Šä¼  | Git submodule ç®¡ç† |

---

## æŠ€æœ¯å†³ç­–

### D-01: æ¶æ„æ¨¡å¼é€‰æ‹©
- **å†³ç­–**: å·¥å‚æ¨¡å¼ (Factory Pattern)
- **æ—¥æœŸ**: 2026-01-27
- **ç†ç”±**: æ‰©å±•æ€§æœ€å¼ºï¼Œç¬¦åˆå¼€é—­åŸåˆ™
- **å¤‡é€‰**: ç­–ç•¥æ¨¡å¼ï¼ˆæ‰©å±•æ€§è¾ƒå·®ï¼‰

### D-02: é»˜è®¤å¼•æ“
- **å†³ç­–**: FunASR æœ¬åœ°ä¼˜å…ˆ
- **æ—¥æœŸ**: 2026-01-27
- **ç†ç”±**: é›¶é…ç½®ï¼Œæ— ç½‘ç»œä¾èµ–
- **å½±å“**: æ–°ç”¨æˆ·æ— éœ€ API Key å³å¯ä½¿ç”¨

### D-03: å›é€€ç­–ç•¥
- **å†³ç­–**: FunASR å¤±è´¥ â†’ MOSS è‡ªåŠ¨å›é€€
- **æ—¥æœŸ**: 2026-01-27
- **ç†ç”±**: ç”¨æˆ·ä½“éªŒä¼˜å…ˆ
- **é™åˆ¶**: MOSS å¤±è´¥æ— å¯å›é€€

### D-04: Fun-ASR-Nano-2512 é›†æˆ
- **å†³ç­–**: å®Œæ•´é›†æˆæ–¹æ¡ˆ Bï¼Œåˆ©ç”¨æµå¼èƒ½åŠ›
- **æ—¥æœŸ**: 2026-01-27
- **ç†ç”±**: åŸç”Ÿæµå¼æ”¯æŒï¼Œ<600ms å»¶è¿Ÿï¼Œ31ç§è¯­è¨€
- **æ–¹æ¡ˆ**: åˆ›å»º FunASRNanoClient ç±»ï¼Œæ·»åŠ  nano-2512 å¼•æ“
- **æ¥æº**: è°ƒç ”æŠ¥å‘Šï¼ˆmemory/patches/2026-01-27-nano-2512è°ƒç ”ç»“æœ.mdï¼‰

### D-06: TTS æ¨¡å‹é€‰æ‹©ï¼ˆvits-zh-hf-fanchen-Cï¼‰
- **æ—¥æœŸ**: 2026-01-28
- **å†³ç­–**: é€‰æ‹© vits-zh-hf-fanchen-C è€Œé Kokoro
- **ç†ç”±**:
  - ç”¨æˆ·ä¸»è§‚è¯„ä»·ï¼švits å¬èµ·æ¥æ›´èˆ’æœ
  - é‡‡æ ·ç‡æ›´é«˜ï¼ˆ16000 Hz vs 24000 Hzï¼Œä½†ä¸­æ–‡è¡¨ç°æ›´å¥½ï¼‰
  - 187 ä¸ªè¯´è¯äººï¼Œé€‰æ‹©ç©ºé—´å¤§
  - æœ¬åœ°æ¨¡å‹ï¼Œæ—  API ä¾èµ–
- **å¯¹æ¯”ç»“æœ**:
  | æ¨¡å‹ | ç”¨æˆ·è¯„ä»· | é‡‡æ ·ç‡ | è¯´è¯äººæ•° |
  |------|---------|--------|---------|
  | vits-zh-hf-fanchen-C | æ›´èˆ’æœ âœ… | 16000 Hz | 187 |
  | kokoro-multi-lang-v1_1 | è‹±æ–‡æ„Ÿå¼º âŒ | 24000 Hz | 103 |

### D-07: éŸ³é‡å¢ç›Šè®¾å®š
- **æ—¥æœŸ**: 2026-01-28
- **å†³ç­–**: ç»Ÿä¸€ä½¿ç”¨ +25dB å¢ç›Š
- **ç†ç”±**: åŸå§‹éŸ³é¢‘éŸ³é‡åå°ï¼Œ+25dB å¯æ˜¾è‘—æå‡å“åº¦
- **å®ç°**:
  ```python
  audio_gain = torch.nn.functional.normalize(audio_tensor, p=2, dim=0) * (10 ** (25.0 / 20))
  ```

### D-08: TTS éŸ³è‰²ç²¾é€‰ç­–ç•¥
- **æ—¥æœŸ**: 2026-01-28
- **ç­–ç•¥**: ä¸¤è½®ç­›é€‰æ³•
  1. **åˆç­›**: 151 ä¸ªæ ·æœ¬ â†’ 36 ä¸ªå€™é€‰ï¼ˆä½¿ç”¨ voice_selector.pyï¼‰
  2. **ç²¾é€‰**: 36 ä¸ª â†’ 27 ä¸ªå€™é€‰ï¼ˆå»é™¤é‡å¤ IDï¼‰
  3. **æœ€ç»ˆ**: 27 ä¸ª â†’ æœ€çˆ±ï¼ˆä½¿ç”¨ voice_selector_final.pyï¼‰
- **æµ‹è¯•æ–‡æœ¬**:
  - çŸ­å¥: "ä½ å¥½ï¼Œæˆ‘æ˜¯å°è·ï¼"
  - ä¸­ç­‰: "ä»Šå¤©è¿‡å¾—æ€ä¹ˆæ ·ï¼Ÿæœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®ä½ çš„å—ï¼Ÿ"
  - é•¿å¥: "å¾ˆé«˜å…´è®¤è¯†ä½ ï¼Œæˆ‘æ˜¯ä½ çš„è¯­éŸ³åŠ©æ‰‹..."
  - æ•…äº‹: "ä»å‰æœ‰ä¸€ä¸ªå°æ‘åº„ï¼Œæ‘åº„é‡Œä½ç€ä¸€ä½å–„è‰¯çš„è€äºº..."
  - å¤©æ°”: "ä»Šå¤©å¤©æ°”çœŸå¥½ï¼é˜³å…‰æ˜åªšï¼Œå¾®é£è½»æ‹‚..."

### D-09: å®æ—¶ç”Ÿæˆæ€§èƒ½æ ‡å‡†
- **æ—¥æœŸ**: 2026-01-28
- **æ ‡å‡†**: RTF < 1.0 å³æ»¡è¶³å®æ—¶ç”Ÿæˆ
- **å®æµ‹ç»“æœ**: 27/27 éŸ³è‰²å…¨éƒ¨æ»¡è¶³å®æ—¶ç”Ÿæˆè¦æ±‚
- **RTF èŒƒå›´**: 0.41x - 0.51xï¼ˆå¹³å‡ 0.47xï¼‰
- **å«ä¹‰**: 8ç§’éŸ³é¢‘åªéœ€ 3.3-4.1ç§’ ç”Ÿæˆï¼Œå¯è¾¹ç”Ÿæˆè¾¹æ’­æ”¾

### D-10: æœ¬åœ°æœåŠ¡æ¶æ„é€‰å‹ï¼ˆPython FastAPIï¼‰
- **æ—¥æœŸ**: 2026-01-29
- **å†³ç­–**: é€‰æ‹© Python FastAPI è€Œé TypeScript/Bun/gRPC
- **ç†ç”±**:
  - **å¿«é€Ÿè¿­ä»£**: å¤ç”¨ç°æœ‰ asr/ å’Œ tts/ ä»£ç ï¼Œæ— éœ€è·¨è¯­è¨€
  - **æœ¬è¿›ç¨‹æ¨ç†**: é›¶ç½‘ç»œé€šä¿¡å¼€é”€ï¼Œæ¨¡å‹åœ¨æœåŠ¡è¿›ç¨‹å†…ç›´æ¥è°ƒç”¨
  - **æŠ€æœ¯é£é™©ä½**: FastAPI æˆç†Ÿç¨³å®šï¼Œå›¢é˜Ÿç†Ÿæ‚‰ Python
  - **API æ–‡æ¡£**: å†…ç½® Swagger UI + OpenAPI Schemaï¼Œæ”¯æŒ Agent ä¸“ç”¨æ–‡æ¡£
- **æ¶æ„**:
  ```
  å®¢æˆ·ç«¯ â”€â”€HTTP/WebSocketâ”€â”€> Voice-ime Service (FastAPI)
                                        â”‚
                                   asr/ + tts/ (ç›´æ¥å¯¼å…¥)
  ```
- **MVP ç«¯ç‚¹**:
  - `POST /v1/asr/transcribe` - ASR è½¬å†™
  - `POST /v1/tts/synthesize` - TTS åˆæˆ
  - `GET /v1/docs/agent` - Agent ä¸“ç”¨æ–‡æ¡£ â­ æ ¸å¿ƒéœ€æ±‚
  - `GET /docs` - Swagger UI
- **å‰ç«¯ç­–ç•¥**: åˆ†ç¦»éƒ¨ç½²ï¼ŒTypeScript + Vue3 ç‹¬ç«‹é¡¹ç›®
- **æ–‡æ¡£**: specs/spec-020a-tech-discussion.md

### D-11: Agent æ–‡æ¡£ API è®¾è®¡
- **æ—¥æœŸ**: 2026-01-29
- **è®¾è®¡**: å¤šå±‚æ¬¡æ–‡æ¡£ä½“ç³»
  - **å±‚çº§ 1**: Swagger UI (`/docs`) - äººç±»äº¤äº’å¼è°ƒè¯•
  - **å±‚çº§ 2**: OpenAPI Schema (`/openapi.json`) - æœºå™¨å¯è¯»
  - **å±‚çº§ 3**: Agent æ–‡æ¡£ (`/v1/docs/agent`) - AI ä¸“ç”¨æç¤ºè¯ â­
- **ç›®çš„**: è®©å¤§æ¨¡å‹/Agent èƒ½ç†è§£å¹¶è°ƒç”¨ Voice-ime API
- **ç¤ºä¾‹å†…å®¹**: å¿«é€Ÿå¼€å§‹ã€ä½¿ç”¨ç¤ºä¾‹ã€é”™è¯¯å¤„ç†ã€æ¨¡å‹é€‰æ‹©å»ºè®®

### D-12: FastAPI æœåŠ¡æµ‹è¯•é…ç½®
- **æ—¥æœŸ**: 2026-01-29
- **é—®é¢˜**: pytest-asyncio å¼‚æ­¥ fixture ä¸å…¼å®¹
- **è§£å†³**: åœ¨ `pyproject.toml` æ·»åŠ é…ç½®ï¼š
  ```toml
  [tool.pytest.ini_options]
  asyncio_mode = "auto"
  asyncio_default_fixture_loop_scope = "function"
  ```
- **æ•™è®­**: pytest-asyncio 0.23+ éœ€è¦æ˜ç¡®é…ç½®æ¨¡å¼

### D-13: FastAPI è¡¨å•æ•°æ®å¤„ç†
- **æ—¥æœŸ**: 2026-01-29
- **é—®é¢˜**: ä½¿ç”¨ `Depends()` æ³¨å…¥ Pydantic æ¨¡å‹ä¸é€‚ç”¨äº multipart/form-data
- **è§£å†³**: ç›´æ¥ä½¿ç”¨ `Form()` å‚æ•°å£°æ˜æ¯ä¸ªè¡¨å•å­—æ®µ
  ```python
  async def transcribe(
      audio: UploadFile = File(...),
      model: ASRModel = Form(ASRModel.PARAFORMER_ZH),
      enable_diarization: bool = Form(False),
      ...
  ):
  ```
- **åŸå› **: `Depends()` ä¾èµ–æ³¨å…¥åœ¨æœ‰ `File()` å‚æ•°æ—¶æ— æ³•æ­£ç¡®è§£æè¡¨å•æ•°æ®

### D-14: Pydantic datetime æ—¶åŒºå¤„ç†
- **æ—¥æœŸ**: 2026-01-29
- **é—®é¢˜**: `datetime.utcnow()` å·²åºŸå¼ƒ
- **è§£å†³**: ä½¿ç”¨ `datetime.now(timezone.utc)` æ›¿ä»£
- **å®ç°**:
  ```python
  from datetime import datetime, timezone
  timestamp: datetime = Field(default_factory=lambda: datetime.now(timezone.utc))
  ```

---

## è¸©å‘è®°å½•

### Bug-01: factory å‚æ•°åç§°é”™è¯¯
- **æ—¥æœŸ**: 2026-01-27
- **é—®é¢˜**: `engine` vs `primary_engine` å‚æ•°åç§°ä¸ä¸€è‡´
- **è§£å†³**: ç»Ÿä¸€ä½¿ç”¨ `primary_engine` å’Œ `fallback_engine`
- **æ•™è®­**: æ¥å£å‚æ•°å‘½åè¦ç»Ÿä¸€è§„èŒƒ

### Bug-02: FunASR 1.3.1 æ¨¡å‹åç§°å˜æ›´
- **æ—¥æœŸ**: 2026-01-27
- **é—®é¢˜**: `SenseVoiceSmall` æ¨¡å‹åç§°å˜æ›´
- **è§£å†³**: æ·»åŠ  `MODEL_REPO_MAP` æ˜ å°„è¡¨
- **æ•™è®­**: å¤–éƒ¨åº“ç‰ˆæœ¬å‡çº§å¯èƒ½ç ´åæ¥å£

### Bug-03: Fun-ASR-Nano-2512 ä¾èµ–ç¼ºå¤±
- **æ—¥æœŸ**: 2026-01-27
- **é—®é¢˜**: `UnboundLocalError: cannot access local variable 'get_tokenizer'`
- **åŸå› **: Fun-ASR-Nano-2512 éœ€è¦ `openai-whisper` å’Œ `transformers>=4.51.3`
- **è§£å†³**: å®‰è£…ç¼ºå¤±ä¾èµ– + å¤åˆ¶ GitHub ä»“åº“çš„ model.pyã€ctc.pyã€decode.pyã€tools/
- **ä¾èµ–å®‰è£…**: `uv pip install openai-whisper transformers>=4.51.3`
- **ä»£ç†**: ä½¿ç”¨ 7890 ç«¯å£ä»£ç†åŠ é€Ÿä¸‹è½½

### Bug-04: Fun-ASR-Nano-2512 éŸ³é¢‘æ ¼å¼å…¼å®¹
- **æ—¥æœŸ**: 2026-01-27
- **é—®é¢˜**: ulaw æ ¼å¼éŸ³é¢‘æ— æ³•å¤„ç†
- **è§£å†³**: ä½¿ç”¨æ ‡å‡† WAV æ ¼å¼ï¼ˆ16kHz, 16bit, monoï¼‰
- **æç¤º**: torchaudio kaldi fbank éœ€è¦æœ‰æ•ˆéŸ³é¢‘æ•°æ®

### Bug-05: sherpa-onnx è¯´è¯äººå‚æ•°åç§°
- **æ—¥æœŸ**: 2026-01-28
- **é—®é¢˜**: TTS ç”Ÿæˆæ—¶ä½¿ç”¨ `speaker_id` å‚æ•°æŠ¥é”™
- **åŸå› **: sherpa-onnx æ–° API ä½¿ç”¨ `sid` è€Œé `speaker_id`
- **è§£å†³**: ä½¿ç”¨ `sid=speaker_id` æ›¿ä»£
- **ä»£ç **:
  ```python
  # é”™è¯¯å†™æ³•
  audio = tts.generate(text, speaker_id=47)

  # æ­£ç¡®å†™æ³•
  audio = tts.generate(text, sid=47)
  ```

### Bug-06: sherpa-onnx éŸ³é‡è¿‡å°
- **æ—¥æœŸ**: 2026-01-28
- **é—®é¢˜**: ç”Ÿæˆçš„éŸ³é¢‘éŸ³é‡åå°ï¼Œå¬ä¸æ¸…
- **è§£å†³**: ä½¿ç”¨ PyTorch å¯¹éŸ³é¢‘è¿›è¡Œå½’ä¸€åŒ–å’Œå¢ç›Šæ”¾å¤§
- **å®ç°**: `+25dB` å¢ç›ŠåéŸ³é‡æ­£å¸¸
- **ä»£ç **:
  ```python
  audio_tensor = torch.from_numpy(audio_data)
  audio_gain = torch.nn.functional.normalize(audio_tensor, p=2, dim=0) * (10 ** (25.0 / 20))
  ```

### Bug-07: Kokoro æ¨¡å‹ç¼ºå°‘ data_dir
- **æ—¥æœŸ**: 2026-01-28
- **é—®é¢˜**: Kokoro æ¨¡å‹åˆå§‹åŒ–æŠ¥é”™
- **åŸå› **: éœ€è¦ `data_dir` å‚æ•°æŒ‡å®š espeak-ng-data ç›®å½•
- **è§£å†³**: æ·»åŠ  `data_dir="models/kokoro/.../espeak-ng-data"`
- **æ•™è®­**: Kokoro éœ€è¦é¢å¤–çš„æ•°æ®æ–‡ä»¶æ”¯æŒä¸­æ–‡å‘éŸ³

### Bug-08: pytest-asyncio å¼‚æ­¥ fixture è­¦å‘Š
- **æ—¥æœŸ**: 2026-01-29
- **é—®é¢˜**: `PytestRemovedIn9Warning: 'test_xxx' requested an async fixture 'client', with no plugin or hook that handled it`
- **è§£å†³**: åœ¨ `pyproject.toml` æ·»åŠ :
  ```toml
  asyncio_mode = "auto"
  asyncio_default_fixture_loop_scope = "function"
  ```
- **æ•™è®­**: pytest-asyncio 0.23+ æ¨¡å¼é…ç½®å¿…éœ€

### Bug-09: FastAPI multipart/form-data è§£æå¤±è´¥
- **æ—¥æœŸ**: 2026-01-29
- **é—®é¢˜**: ä½¿ç”¨ `Depends(ASRTranscribeRequest)` æ—¶è¡¨å•å‚æ•°æœªæ­£ç¡®è§£æï¼Œè¿”å›é»˜è®¤ model å€¼
- **è§£å†³**: æ”¹ç”¨ `Form()` å‚æ•°ç›´æ¥å£°æ˜æ¯ä¸ªå­—æ®µ
- **ä»£ç **:
  ```python
  # é”™è¯¯å†™æ³•
  async def transcribe(audio: UploadFile, request: ASRTranscribeRequest = Depends()):
      model = request.model.value  # æ€»æ˜¯é»˜è®¤å€¼

  # æ­£ç¡®å†™æ³•
  async def transcribe(audio: UploadFile, model: ASRModel = Form(...)):
      model = model.value  # æ­£ç¡®è·å–ç”¨æˆ·å€¼
  ```

### Bug-10: Pydantic datetime éªŒè¯é”™è¯¯
- **æ—¥æœŸ**: 2026-01-29
- **é—®é¢˜**: `HealthResponse(timestamp=None)` éªŒè¯å¤±è´¥
- **åŸå› **: datetime ç±»å‹ä¸æ¥å— None
- **è§£å†³**: ç»™ timestamp æ·»åŠ  `Field(default_factory=...)`
- **ä»£ç **:
  ```python
  class HealthResponse(BaseModel):
      timestamp: datetime = Field(default_factory=lambda: datetime.now(timezone.utc))
  ```

---

## æ€§èƒ½æµ‹è¯•ç»“æœ

### Fun-ASR-Nano-2512
| æŒ‡æ ‡ | ç»“æœ | è¯´æ˜ |
|------|------|------|
| æ¨¡å‹åŠ è½½æ—¶é—´ | 19.16s | å« 4GB æ¨¡å‹ä¸‹è½½ |
| RTF (å®æ—¶å› å­) | **0.776** | æ¯”å®æ—¶ï¼ˆ1.0ï¼‰å¿« 22% |
| æ¨ç†é€Ÿåº¦ | â‰¥1x å®æ—¶ç‡ | è¶…å®æ—¶æ€§èƒ½ |
| å»¶è¿Ÿ | <600ms | åŸç”Ÿæµå¼æ”¯æŒ |
| æµ‹è¯•çŠ¶æ€ | âœ… é€šè¿‡ | 6/6 æµ‹è¯•ç”¨ä¾‹é€šè¿‡ |

### FunASR (paraformer-zh)
| æŒ‡æ ‡ | ç»“æœ |
|------|------|
| RTF (å®æ—¶å› å­) | 0.261 |
| æ¨ç†é€Ÿåº¦ | ~4x å®æ—¶ç‡ |

---

## ASR å¼•æ“ç‰¹æ€§

### FunASR (ä¼ ç»Ÿæ¨¡å‹)
| æ¨¡å‹ | ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|------|---------|
| paraformer-zh | ä¸­æ–‡é€šç”¨ï¼Œå¸¦æ—¶é—´æˆ³ | ç¦»çº¿è½¬å†™ã€å­—å¹• |
| SenseVoiceSmall | é«˜ç²¾åº¦ï¼Œå¤šè¯­è¨€ç†è§£ | é«˜ç²¾åº¦è½¬å†™ã€æƒ…æ„Ÿ |
| paraformer-en | è‹±æ–‡ä¸“ç”¨ | è‹±æ–‡å†…å®¹è½¬å†™ |

### Fun-ASR-Nano-2512 (æ–°å®æ—¶å¼•æ“)
| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| å‚æ•°é‡ | ~2.5B |
| è¯­è¨€æ”¯æŒ | 31 ç§è¯­è¨€ |
| æ¨ç†é€Ÿåº¦ | â‰¥1x å®æ—¶ç‡ |
| å»¶è¿Ÿ | <600ms |
| æ˜¾å­˜å ç”¨ | <4GB |
| æ–¹è¨€æ”¯æŒ | 7 ç§ä¸­æ–‡æ–¹è¨€ + 26 ç§å£éŸ³ |
| æµå¼æ”¯æŒ | åŸç”Ÿæµå¼è½¬å†™ |
| æ¨¡å‹ä»“åº“ | FunAudioLLM/Fun-ASR-Nano-2512 |

### MOSS
- **ä¼˜ç‚¹**: æ”¯æŒè¯´è¯äººåˆ†ç¦»ï¼ŒAPI ç®€å•
- **ç¼ºç‚¹**: éœ€è¦ç½‘ç»œï¼Œéœ€è¦ API Key

---

## ç”¨æˆ·åå¥½

| åå¥½ | è¯´æ˜ |
|------|------|
| æœ¬åœ°ä¼˜å…ˆ | ä¼˜å…ˆä½¿ç”¨æœ¬åœ°å¼•æ“ï¼Œå‡å°‘ä¾èµ– |
| é›¶é…ç½® | æ–°ç”¨æˆ·æ— éœ€å¤æ‚é…ç½®å³å¯ä½¿ç”¨ |
| è‡ªåŠ¨å›é€€ | å¤±è´¥æ—¶è‡ªåŠ¨åˆ‡æ¢åˆ°å¤‡é€‰æ–¹æ¡ˆ |

---

## å¾…åŠè·Ÿè¸ª

- [ ] T-11: å£°çº¹è¯†åˆ«åŠŸèƒ½
- [ ] T-12: å°è£…ä¸ºå¤–æ˜Ÿç»„ä»¶
- [ ] T-13: è¯´è¯äººåˆ†ç¦»ä¼˜åŒ–
- [x] T-14: Fun-ASR-Nano-2512 é›†æˆ (å·²å®Œæˆ)
  - [x] T-14.1: åˆ›å»º FunASRNanoClient ç±»
  - [x] T-14.2: æ›´æ–° factory æ”¯æŒæ–°æ¨¡å‹
  - [x] T-14.3: æ·»åŠ å‘½ä»¤è¡Œå‚æ•°
  - [x] T-14.4: æ€§èƒ½æµ‹è¯•å¯¹æ¯” (RTF: 0.776)
- [x] T-15: TTS éŸ³è‰²æœ€ç»ˆç²¾é€‰
  - [x] T-15.1: ç”Ÿæˆ 151 ä¸ªè¯´è¯äººæ ·æœ¬ (+25dB)
  - [x] T-15.2: åˆç­›å·¥å…· voice_selector.py
  - [x] T-15.3: é€Ÿåº¦æµ‹è¯• test_final_speakers.py
  - [x] T-15.4: ç²¾é€‰å·¥å…· voice_selector_final.py
  - [x] T-15.5: æœ€ç»ˆé€‰æ‹©å¹¶é…ç½® (ID 77, ID 99)

---

## æŠ€æœ¯å‘ç°ä¸å­¦ä¹ 

### å‘ç°-01: Aule-Attention
- **æ—¥æœŸ**: 2026-01-28
- **ä»“åº“**: `github.com/AuleTechnologies/Aule-Attention`
- **ä½œè€…**: Aule Technologies (Yeabsira Teshome)
- **åè®®**: MIT (å¼€æº)
- **æŠ€æœ¯æ ˆ**: Zig + Python + Vulkan + Triton + PyTorch
- **æ ¸å¿ƒåŠŸèƒ½**:
  - ç¡¬ä»¶æ— å…³çš„ FlashAttention-2 å®ç°
  - æ”¯æŒ AMD/Intel/Apple GPU
  - ä½œä¸º PyTorch SDPA çš„å³æ’å³ç”¨æ›¿ä»£å“
  - O(N) å†…å­˜å¤æ‚åº¦ï¼Œé¿å…ç‰©åŒ–å®Œæ•´æ³¨æ„åŠ›çŸ©é˜µ
- **å±€é™**:
  - ä¸æ”¯æŒ LCM (Latent Consistency Model)
  - ä¸æ”¯æŒ ROCm 7.11ï¼ˆå½“å‰ç¯å¢ƒç‰ˆæœ¬ï¼‰
- **å­¦ä¹ ä»·å€¼**: Zig ç³»ç»Ÿç¼–ç¨‹ã€Triton GPU å†…æ ¸ã€FlashAttention ç®—æ³•

### å‘ç°-02: ZeRO / ZeRO-K
- **æ—¥æœŸ**: 2026-01-28
- **æ¥æº**: ä¸ Aule-Attention ç›¸å…³çš„ Redis è®°å½•
- **æ¦‚è¿°**: ZeRO (Zero Redundancy Optimizer) æ˜¯ DeepSpeed çš„æ ¸å¿ƒå†…å­˜ä¼˜åŒ–æŠ€æœ¯
- **ä¸‰ä¸ªé˜¶æ®µ**:

| Stage | åˆ†ç‰‡å†…å®¹ | å†…å­˜èŠ‚çœ |
|-------|---------|---------|
| ZeRO-1 | ä¼˜åŒ–å™¨çŠ¶æ€ | ~4x |
| ZeRO-2 | ä¼˜åŒ–å™¨çŠ¶æ€ + æ¢¯åº¦ | ~8x |
| ZeRO-3 | ä¼˜åŒ–å™¨çŠ¶æ€ + æ¢¯åº¦ + å‚æ•° | ~16x |

- **åŸç†**: é€šè¿‡åˆ†å¸ƒå¼å­˜å‚¨å‡å°‘æ¯ä¸ª GPU çš„å†—ä½™å†…å­˜å ç”¨
- **å­¦ä¹ ä»·å€¼**: åˆ†å¸ƒå¼è®­ç»ƒã€å†…å­˜ä¼˜åŒ–ã€DeepSpeed é›†æˆ

### å‘ç°-03: Sherpa-ONNX TTS
- **æ—¥æœŸ**: 2026-01-28
- **æ¦‚è¿°**: è·¨å¹³å° ONNX è¯­éŸ³åˆæˆåº“ï¼Œæ”¯æŒ TTSã€ASRã€è¯´è¯äººè¯†åˆ«
- **å®˜ç½‘**: https://k2-fsa.github.io/sherpa/onnx/
- **ä¸‹è½½åœ°å€**: https://github.com/k2-fsa/sherpa-onnx/releases/tag/tts-models

---

## TTS æ¨¡å‹æµ‹è¯•ç»“æœ

### æ¨¡å‹å¯¹æ¯”

| æ¨¡å‹ | é‡‡æ ·ç‡ | æ¨¡å‹å¤§å° | RTF | éŸ³è´¨ | æ¨èåœºæ™¯ |
|------|--------|----------|-----|------|---------|
| **vits-zh-hf-fanchen-C** | 16000 Hz | ~328MB | 0.47x | â­â­â­â­â­ | **ç”¨æˆ·é¦–é€‰** |
| kokoro-multi-lang-v1_1 | 24000 Hz | ~350MB | - | â­â­â­ | è‹±æ–‡ä¸ºä¸» |
| vits-zh-aishell3 | 8000 Hz | ~115MB | 0.24x | â­â­â­ | æè‡´é€Ÿåº¦ |

### æ¨¡å‹é€‰æ‹©å†³ç­–
- **ç”¨æˆ·é€‰æ‹©**: vits-zh-hf-fanchen-C
- **ç†ç”±**: ç”¨æˆ·ä¸»è§‚è¯„ä»·"å¬èµ·æ¥æ›´èˆ’æœ"ï¼Œä¸­æ–‡è¡¨ç°æ›´å¥½
- **å¤‡é€‰**: Kokoroï¼ˆå› "è‹±æ–‡æ„Ÿå¼º"è¢«æ”¾å¼ƒï¼‰

### éŸ³è‰²ç­›é€‰è¿‡ç¨‹

#### åˆç­›ç»“æœï¼ˆ36 ä¸ªå€™é€‰ï¼‰
ä» 151 ä¸ªè¯´è¯äººä¸­é€‰å‡º 36 ä¸ªï¼š

| è¯„åˆ† | æ•°é‡ | å…¸å‹è¯„è¯­ |
|------|------|---------|
| â­â­â­â­â­ | 9 | "å¾ˆå¥½"ã€"æ²‰ç¨³ æ¸©æš–"ã€"å¾ˆç”œç¾"ã€"æ²‰ç¨³ æˆç†Ÿ"ã€"ç”œ" |
| â­â­â­â­ | 20 | "æ¸…è„†"ã€"ä½æ²‰ä¸€ç‚¹çš„å¥³å£°"ã€"è½»å¿«"ã€"æ’­éŸ³" |
| â­â­â­ | 5 | "èŒèŒçš„"ã€"è¿˜è¡Œ" |
| â­ | 1 | "å¤§å¦ˆ"ï¼ˆä¸å–œæ¬¢ï¼‰ |

#### ç²¾é€‰ç»“æœï¼ˆ27 ä¸ªå€™é€‰ï¼Œå»é‡åï¼‰
**5æ˜ŸéŸ³è‰²ï¼ˆ8ä¸ªï¼‰**:
| ID | è¯„è¯­ | RTF |
|----|------|-----|
| 1 | å¾ˆå¥½ | 0.45x |
| 6 | ç”œ | 0.46x |
| 27 | - | 0.48x |
| 50 | å¾ˆå¥½ | 0.49x |
| 77 | æ²‰ç¨³ æ¸©æš– | 0.49x |
| 87 | å¾ˆç”œç¾ | 0.49x |
| 99 | æ²‰ç¨³ æˆç†Ÿ | 0.48x |
| 146 | - | 0.50x |

**4æ˜ŸéŸ³è‰²ï¼ˆ19ä¸ªï¼‰**:
| ID | è¯„è¯­ | RTF |
|----|------|-----|
| 8 | - | 0.41x |
| 22 | æ¸…è„† | 0.49x |
| 24 | - | 0.44x |
| 29 | - | 0.49x |
| 79 | - | 0.47x |
| 80 | ä½æ²‰ä¸€ç‚¹çš„å¥³å£° | 0.44x |
| 81 | è½»å¿« | 0.43x |
| 93 | - | 0.44x |
| 103 | ç”Ÿæ¶©å­¦ç”Ÿ | 0.45x |
| 106 | æ’­éŸ³ | 0.48x |
| 109 | æ’­éŸ³ | 0.47x |
| 111 | - | 0.49x |
| 112 | æ’­éŸ³ | 0.48x |
| 122 | - | 0.44x |
| 127 | - | 0.51x |
| 129 | å¹¿ä¸œäºº | 0.46x |
| 130 | - | 0.49x |
| 139 | - | 0.44x |
| 145 | - | 0.43x |

### å®æ—¶ç”Ÿæˆæ€§èƒ½æµ‹è¯•

#### æµ‹è¯•ç»“æœ
- **æµ‹è¯•éŸ³è‰²æ•°**: 27 ä¸ª
- **å®æ—¶ç”Ÿæˆ**: 27/27 âœ… (100%)
- **RTF èŒƒå›´**: 0.41x - 0.51x
- **å¹³å‡ RTF**: 0.47x

#### é€Ÿåº¦æ’åï¼ˆTop 10ï¼‰
| æ’å | ID | RTF | å®æ—¶ | è¯„åˆ† | è¯„è¯­ |
|------|-----|-----|------|------|------|
| 1 | 8 | 0.41x | âœ… | â­â­â­â­ | - |
| 2 | 81 | 0.43x | âœ… | â­â­â­â­ | è½»å¿« |
| 3 | 145 | 0.43x | âœ… | â­â­â­â­ | - |
| 4 | 80 | 0.44x | âœ… | â­â­â­â­ | ä½æ²‰å¥³å£° |
| 5 | 93 | 0.44x | âœ… | â­â­â­â­ | - |
| 6 | 24 | 0.44x | âœ… | â­â­â­â­ | - |
| 7 | 122 | 0.44x | âœ… | â­â­â­â­ | - |
| 8 | 139 | 0.44x | âœ… | â­â­â­â­ | - |
| 9 | 1 | 0.45x | âœ… | â­â­â­â­â­ | å¾ˆå¥½ |
| 10 | 103 | 0.45x | âœ… | â­â­â­â­ | ç”Ÿæ¶©å­¦ç”Ÿ |

#### æµ‹è¯•æ–‡æœ¬ç¤ºä¾‹
| ç±»å‹ | æ–‡æœ¬å†…å®¹ |
|------|---------|
| çŸ­å¥ | "ä½ å¥½ï¼Œæˆ‘æ˜¯å°è·ï¼" |
| ä¸­ç­‰ | "ä»Šå¤©è¿‡å¾—æ€ä¹ˆæ ·ï¼Ÿæœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®ä½ çš„å—ï¼Ÿ" |
| é•¿å¥ | "å¾ˆé«˜å…´è®¤è¯†ä½ ï¼Œæˆ‘æ˜¯ä½ çš„è¯­éŸ³åŠ©æ‰‹ã€‚æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®ä½ çš„å—ï¼Ÿä»Šå¤©è¿‡å¾—æ€ä¹ˆæ ·ï¼Œå·¥ä½œè¿˜é¡ºåˆ©å—ï¼Ÿ" |
| æ•…äº‹ | "ä»å‰æœ‰ä¸€ä¸ªå°æ‘åº„ï¼Œæ‘åº„é‡Œä½ç€ä¸€ä½å–„è‰¯çš„è€äººã€‚ä»–æ¯å¤©éƒ½ä¼šå¸®åŠ©æœ‰éœ€è¦çš„äººï¼Œæ‘æ°‘ä»¬éƒ½éå¸¸å°Šæ•¬ä»–ã€‚" |
| å¤©æ°” | "ä»Šå¤©å¤©æ°”çœŸå¥½ï¼é˜³å…‰æ˜åªšï¼Œå¾®é£è½»æ‹‚ã€‚é€‚åˆå‡ºå»æ•£æ­¥ï¼Œå‘¼å¸æ–°é²œç©ºæ°”ã€‚ä½ é‚£è¾¹å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ" |

### æ¨èæœ€ç»ˆä½¿ç”¨

#### ğŸ¥‡ æœ€ä½³é€‰æ‹©ï¼šID 1 æˆ– ID 6
- 5æ˜Ÿè¯„åˆ† + æœ€å¿«é€Ÿåº¦ (0.45-0.46x)
- éŸ³è´¨å¥½ï¼Œå“åº”é€Ÿåº¦å¿«

#### ğŸ¥ˆ å¤‡é€‰
- **ID 27**: 5æ˜Ÿ + 0.48x
- **ID 99**: 5æ˜Ÿ + æ²‰ç¨³æˆç†Ÿé£æ ¼
- **ID 77**: 5æ˜Ÿ + æ²‰ç¨³æ¸©æš–é£æ ¼

### VITS ä½¿ç”¨æ–¹æ³•

```python
import sherpa_onnx

# åˆ›å»º TTSï¼ˆvits-zh-hf-fanchen-Cï¼‰
model_config = sherpa_onnx.OfflineTtsModelConfig(
    vits=sherpa_onnx.OfflineTtsVitsModelConfig(
        model="models/vits-zh-hf-fanchen-C/vits-zh-hf-fanchen-C.onnx",
        tokens="models/vits-zh-hf-fanchen-C/tokens.txt",
        lexicon="models/vits-zh-hf-fanchen-C/lexicon.txt",
    ),
)
tts = sherpa_onnx.OfflineTts(sherpa_onnx.OfflineTtsConfig(model=model_config))

# ç”ŸæˆéŸ³é¢‘ï¼ˆä½¿ç”¨ sid å‚æ•°ï¼Œæ¨è ID: 1 æˆ– 6ï¼‰
audio = tts.generate("ä½ å¥½ï¼Œæˆ‘æ˜¯è¯­éŸ³åŠ©æ‰‹", sid=1, speed=1.0)
```

### éŸ³é‡æ”¾å¤§ï¼ˆ+25dBï¼‰

```python
import numpy as np
import torch

# è½¬æ¢å’Œå¢ç›Š
audio_data = np.array(audio.samples, dtype=np.float32)
audio_tensor = torch.from_numpy(audio_data)
audio_gain = torch.nn.functional.normalize(audio_tensor, p=2, dim=0) * (10 ** (25.0 / 20))
audio_data = audio_gain.numpy()

# ä¿å­˜
sherpa_onnx.write_wave("output.wav", audio_data, tts.sample_rate)
```

### é¡¹ç›®æ–‡ä»¶ç´¢å¼•

| æ–‡ä»¶ | ç”¨é€” |
|------|------|
| `voice_selector.py` | åˆç­›å·¥å…·ï¼ˆ151 â†’ 36ï¼‰ |
| `test_final_speakers.py` | é€Ÿåº¦æµ‹è¯•å·¥å…· |
| `voice_selector_final.py` | ç²¾é€‰å·¥å…·ï¼ˆ36 â†’ æœ€ç»ˆï¼‰ |
| `liked_voices.txt` | åˆç­›ç»“æœ |
| `final_favorite_voices.txt` | æœ€ç»ˆç²¾é€‰ç»“æœ |
| `sherpa_output/speakers_vits_fanchen/` | 151 ä¸ªåˆç­›æ ·æœ¬ |
| `sherpa_output/final_test/` | 27 ä¸ªç²¾é€‰æ ·æœ¬ |

---

## Git æäº¤ä¸ PR æµç¨‹ (v1.6)

### Git æäº¤è§„èŒƒ

**å°æäº¤ï¼ˆæ¯æ­¥/å°ä¿®æ”¹ï¼‰**ï¼š
```bash
# æ›´æ–°é•¿æœŸè®°å¿†
git add pm/memory/long-term.md
git commit -m "refactor: æ›´æ–°é•¿æœŸè®°å¿† [åšäº†ä»€ä¹ˆ + ç´¢å¼•æ–‡ä»¶]"
```

**æäº¤æ ¼å¼æ¨¡æ¿**ï¼š
```
[ç±»å‹]: [ç®€çŸ­æè¿°]

- åšä»€ä¹ˆ: 1-2å¥è¯
- ç´¢å¼•æ–‡ä»¶: path/to/file (å˜æ›´çš„æ–‡ä»¶)
```

### åˆ†æ”¯ PR æµç¨‹

```bash
# 1. åŠŸèƒ½å®Œæˆï¼Œåˆ›å»º PR
git branch feature/xxx-è¿­ä»£12-fastapi
git checkout feature/xxx-è¿­ä»£12-fastapi
# ... å¼€å‘ ...
git push -u origin feature/xxx-è¿­ä»£12-fastapi
gh pr create --title "feat: FastAPI æœåŠ¡å®ç°" --body "..."

# 2. Squash merge åˆ°ä¸»åˆ†æ”¯
# åœ¨ GitHub UI ç‚¹å‡» "Squash and merge"

# 3. è®°å½• PR ç¼–å·åˆ° memory
```

### é•¿æœŸè®°å¿†æ›´æ–°æ—¶æœº

| æ—¶æœº | æ›´æ–°å†…å®¹ |
|------|----------|
| æ¶æ„è®¾è®¡å | Spec æ–‡ä»¶è·¯å¾„ã€ä¸»è¦è®¾è®¡å†³ç­– |
| ç¼–ç å®Œæˆå | å˜æ›´çš„æ–‡ä»¶ã€æ ¸å¿ƒä»£ç ä½ç½® |
| æµ‹è¯•é€šè¿‡å | æµ‹è¯•æ–‡ä»¶ã€è¦†ç›–ç‡ |
| éƒ¨ç½²å®Œæˆå | systemd æœåŠ¡çŠ¶æ€ã€ç«¯å£ |
| PR åˆå¹¶å | PR ç¼–å·ã€åŠŸèƒ½æ‘˜è¦ |
| **PR åˆå¹¶å** | **æ—¥è®°æ›´æ–°ï¼ˆ100å­—æ‘˜è¦ï¼‰** â­ |

---

### è‡ªåŠ¨åŒ–éƒ¨ç½²å‘½ä»¤

```bash
# å¼€å‘æ¨¡å¼ï¼ˆåå°è¿è¡Œï¼‰
uv run python -m service.main

# æœåŠ¡æ¨¡å¼ï¼ˆç”¨æˆ·çº§ systemdï¼‰
systemctl --user start exomind-model
systemctl --user enable exomind-model

# æœåŠ¡ç®¡ç†
systemctl --user status exomind-model
journalctl --user -u exomind-model -f

# éƒ¨ç½²åæµ‹è¯•
curl http://localhost:1921/health
curl http://localhost:1921/v1/docs/agent
```

---

## éšç§ç½‘å…³å®éªŒï¼ˆå·²å½’æ¡£ DEPRECATEDï¼‰

### PG-01: éšç§ä¿æŠ¤ç½‘å…³ MVP
- **æ—¥æœŸ**: 2026-01-29
- **çŠ¶æ€**: DEPRECATEDï¼ˆæš‚åœï¼‰
- **å†³ç­–**: æš‚ä¸é›†æˆåˆ° exomind-model æ ¸å¿ƒé¡¹ç›®
- **ç†ç”±**: å½“å‰ä¼˜å…ˆçº§ä¸º ASR/TTS æ ¸å¿ƒåŠŸèƒ½ï¼Œéšç§ç½‘å…³å¯ä½œä¸ºç‹¬ç«‹é¡¹ç›®
- **æŠ€æœ¯ç§¯ç´¯**:
  - PII æ­£åˆ™æ£€æµ‹æ¨¡å¼ (`pii/patterns.py`)
  - Token åŒå°„æ˜ å°„å­˜å‚¨ (`storage/token_store.py`)
  - API è·¯ç”±è®¾è®¡ (`api/routes.py`)
- **æ–‡ä»¶ä½ç½®**: `privacy_gateway/`ï¼ˆä¿ç•™ä»£ç ï¼Œæ ‡è®°ä¸º DEPRECATEDï¼‰
- **å‚è€ƒæ–‡æ¡£**: `specs/spec-020c-privacy-gateway.md`

### å‘ç°-04: Microsoft Presidio
- **æ—¥æœŸ**: 2026-01-29
- **æ¦‚è¿°**: å¾®è½¯å¼€æºçš„ PII æ£€æµ‹ä¸åŒ¿ååŒ–æ¡†æ¶
- **ä»“åº“**: microsoft/presidio
- **ç‰¹ç‚¹**:
  - æ”¯æŒå¤šç§ PII ç±»å‹æ£€æµ‹
  - å¯è‡ªå®šä¹‰æ£€æµ‹å™¨
  - æ”¯æŒæœ¬åœ°æ¨¡å‹ï¼ˆMiniRBTï¼‰
- **å­¦ä¹ ä»·å€¼**: PII æ£€æµ‹æ¶æ„è®¾è®¡ã€å¯é…ç½®åŒ–æ£€æµ‹å™¨

### D-15: ASR å¼•æ“ API é›†æˆ
- **æ—¥æœŸ**: 2026-01-29
- **å†³ç­–**: ä½¿ç”¨ ASRClientFactory å·¥å‚æ¨¡å¼é›†æˆå¼•æ“
- **å®ç°**:
  - `/v1/asr/transcribe` â†’ é›†æˆ nano-2512 è½¬å†™
  - `/v1/asr/stream/transcribe` â†’ æ–°å¢æµå¼ç«¯ç‚¹
- **å˜æ›´æ–‡ä»¶**: `service/api/asr.py` (+165 è¡Œ)
- **æµ‹è¯•çŠ¶æ€**: å¾…è¿è¡Œ pytest

### D-16: è¯´è¯äººåˆ†ç¦» API é›†æˆ
- **æ—¥æœŸ**: 2026-01-30
- **å†³ç­–**: ç‹¬ç«‹ `/v1/speaker/*` ç«¯ç‚¹ï¼Œä½¿ç”¨ CAM++ å¼•æ“
- **å®ç°**:
  - `POST /v1/speaker/diarize` â†’ è¯´è¯äººåˆ†ç¦»ä¸»ç«¯ç‚¹
  - `GET /v1/speaker/engines` â†’ åˆ—å‡ºå¯ç”¨å¼•æ“
  - `GET /v1/speaker/health/{engine}` â†’ å¼•æ“å¥åº·æ£€æŸ¥
- **å˜æ›´æ–‡ä»¶**:
  - `service/api/speaker.py` (æ–°å¢ï¼Œ+107 è¡Œ)
  - `service/models/request.py` (+18 è¡Œï¼ŒSpeakerDiarizeRequest)
  - `service/models/response.py` (+18 è¡Œï¼ŒSpeakerDiarizeResult)
  - `service/api/__init__.py` (+2 è¡Œï¼Œspeaker_router)
  - `service/main.py` (+2 è¡Œï¼Œå¯¼å…¥speaker_router)
- **æµ‹è¯•æ–‡ä»¶**: `tests/test_speaker_api.py` (æ–°å¢ï¼Œ+107 è¡Œ)
- **æµ‹è¯•çŠ¶æ€**: 8/8 é€šè¿‡ âœ…
- **API ç«¯ç‚¹**:
  | ç«¯ç‚¹ | æ–¹æ³• | æè¿° |
  |------|------|------|
  | `/v1/speaker/diarize` | POST | è¯´è¯äººåˆ†ç¦» |
  | `/v1/speaker/engines` | GET | åˆ—å‡ºå¼•æ“ |
  | `/v1/speaker/health/{engine}` | GET | å¼•æ“å¥åº·æ£€æŸ¥ |

---

*æœ¬æ–‡ä»¶éµå¾ª life-os/core/memory-workflow.md æ›´æ–°è§„èŒƒ*
*æœ€åæ›´æ–°: 2026-01-29 15:10*
